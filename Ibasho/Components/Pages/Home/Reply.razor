@*
    返信画面
*@
@page "/reply/{PostId:long}"
@using Ibasho.Application.UseCases.Replies
@using Ibasho.Components.Partials.Shared
@inject GetThreadUseCase GetThreadUseCase

<PageTitle>Ibasho - 返信</PageTitle>

<div class="space-y-4">
    @* ヘッダー *@
    <div class="flex items-center space-x-3 p-4">
        <a href="@Home.Path" class="p-2 rounded-full hover:bg-gray-100">
            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
        </a>
        <h1 class="text-2xl font-bold text-gray-800">ポスト</h1>
    </div>

    @* 元投稿 *@
    @if (ParentPost == null)
    {
        <div class="p-4 text-center text-gray-500">投稿が見つかりません</div>
    }
    else
    {
        <PostItem Post="@ParentPost" />
    }

    @* 返信フォーム + 返信一覧 *@
    <div class="p-4">
        <PostList Mode="Reply" ParentPostId="@PostId" Posts="@Thread" />
    </div>
</div>

@code {
    // パス
    public static string Path = "/reply";

    // 投稿Id
    [Parameter] public long PostId { get; set; } = 0;

    // 元投稿
    private PostListItemDto? ParentPost;

    // 返信投稿一覧
    private List<PostListItemDto>? Thread;

    /// <summary>
    /// 初期表示時
    /// </summary>
    protected override async Task OnInitializedAsync()
    {
        string? userId = await UserAuthHelper.GetUserIdAsync(AuthStateProvider);
        if (!string.IsNullOrEmpty(userId))
        {
            var (parent, thread) = await GetThreadUseCase.ExecuteAsync(PostId, userId);
            ParentPost = parent;
            Thread = thread.ToList();
        }
    }
}